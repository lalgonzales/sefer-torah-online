project:
  type: book
  output-dir: _site

book:
  title: "Sefer Torah Online"
  subtitle: "Siddur y Torá Digital Bilingüe"
  author: "Luis Alfredo López Gonzales"
  chapters:
    - index.qmd
    - part: "Siddur - Libro de Oraciones"
      chapters:
        - content/siddur/shakharit.qmd
    - part: "Torá - Bereshit (Génesis)"
      chapters:
        - content/parashot/bereshit.qmd
  navbar:
    right:
      - icon: github
        href: https://github.com/lalgonzales/sefer-torah-online

format:
  html:
    theme: cosmo
    css: styles/custom.css
    toc-collapse: true
    toc-depth: 5
    number-sections: false
    base-url: /sefer-torah-online/
    include-after-body:
      - text: |
          <script>
          // View controls for trilingual triple-view content
          document.addEventListener('DOMContentLoaded', function() {
            // Create controls only if there are triple-view elements on the page
            const tripleViews = document.querySelectorAll('.triple-view');
            if (tripleViews.length === 0) return;

            // Load saved preferences
            const savedPrefs = {
              hebrew: localStorage.getItem('show-hebrew') !== 'false',
              transliteration: localStorage.getItem('show-transliteration') !== 'false',
              translation: localStorage.getItem('show-translation') !== 'false'
            };

            // Create controls
            const controls = document.createElement('div');
            controls.className = 'view-controls';
            controls.id = 'global-view-controls';
            controls.innerHTML = `
              <strong>Mostrar:</strong>
              <button id="toggle-hebrew" class="${savedPrefs.hebrew ? 'active' : ''}">
                עברית Hebreo
              </button>
              <button id="toggle-transliteration" class="${savedPrefs.transliteration ? 'active' : ''}">
                Fonética
              </button>
              <button id="toggle-translation" class="${savedPrefs.translation ? 'active' : ''}">
                Español
              </button>
            `;

            // Insert controls at the beginning of main content
            const mainContent = document.querySelector('main') || document.querySelector('.page-columns');
            if (mainContent && mainContent.firstChild) {
              mainContent.insertBefore(controls, mainContent.firstChild);
            }

            // Apply saved preferences
            applyPreferences(savedPrefs);

            // Event listeners para los botones
            document.getElementById('toggle-hebrew').addEventListener('click', function() {
              toggleColumn('hebrew');
            });

            document.getElementById('toggle-transliteration').addEventListener('click', function() {
              toggleColumn('transliteration');
            });

            document.getElementById('toggle-translation').addEventListener('click', function() {
              toggleColumn('translation');
            });

            function toggleColumn(column) {
              const button = document.getElementById(`toggle-${column}`);
              const isActive = button.classList.contains('active');

              if (isActive) {
                button.classList.remove('active');
                document.body.classList.add(`hide-${column}`);
                localStorage.setItem(`show-${column}`, 'false');
              } else {
                button.classList.add('active');
                document.body.classList.remove(`hide-${column}`);
                localStorage.setItem(`show-${column}`, 'true');
              }
            }

            function applyPreferences(prefs) {
              if (!prefs.hebrew) {
                document.body.classList.add('hide-hebrew');
              }
              if (!prefs.transliteration) {
                document.body.classList.add('hide-transliteration');
              }
              if (!prefs.translation) {
                document.body.classList.add('hide-translation');
              }
            }
          });
          </script>
    include-in-header:
      text: |
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NMM5NMZ6');</script>
        <!-- End Google Tag Manager -->
    include-before-body:
      text: |
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMM5NMZ6"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
